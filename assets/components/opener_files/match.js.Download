var tpuiUrl=!tpuiUrl?"ih.adscale.de/tpui":tpuiUrl;function match(f){var g={KEY:"unsent-matches",recallMatches:function(){var l=[];if(window.localStorage){var k=localStorage.getItem(this.KEY);if(k!==null){try{var m=JSON.parse(k);var o=m.filter(function(p){return typeof p==="object"&&p.tpid&&typeof p.tpid==="number"&&p.tpuid&&typeof p.tpuid==="string"});if(o.length!==m.length){localStorage.setItem(this.KEY,JSON.stringify(o));l=o}else{l=m}}catch(n){localStorage.removeItem(this.KEY)}}}return l},rememberMatch:function(k){if(window.localStorage){var l=this.recallMatches();if(l.filter(function(m){return m.tpid===k.tpid}).length===0){l.push(k);localStorage.setItem(this.KEY,JSON.stringify(l))}}},forgetMatches:function(n){if(window.localStorage){var m=this.recallMatches();for(var l=0;l<n.length;l++){for(var k=0;k<m.length;k++){if(m[k].tpid===n[l].tpid){m.splice(k,1);break}}}localStorage.setItem("unsent-matches",JSON.stringify(m))}}};var d=g.recallMatches();var j=window.location.protocol==="https:"?"https://":"http://";f=f.slice().filter(function(l){for(var k=0;k<d.length;k++){var m=l.url.indexOf("https://")===0;if(l.tpid===d[k].tpid||(j==="https://"&&!m)){return false}}return true});var a=(function(){var k=false;return function(m){if(m===undefined){m=true}if(!k){var n=d.splice(0,d.length);if(n.length>0){k=true;var o=new XMLHttpRequest();o.onreadystatechange=function(){if(o.readyState===4){if(o.status===200){b+=n.length;g.forgetMatches(n)}else{Array.prototype.push.apply(d,n)}k=false}};var l=j+tpuiUrl;o.open("POST",l,m);o.withCredentials=true;o.setRequestHeader("Content-type","application/json");o.send(JSON.stringify(n))}}}})();var b=0;var c=f.length+d.length;a();window.done=function(m,k){var l={tpid:m,tpuid:k};d.push(l);g.rememberMatch(l);if(d.length===c){a()}};window.onbeforeunload=function(){a(false)};setTimeout(function(){if(b<c){a();setTimeout(arguments.callee,1000)}},1000);function e(m,k,l){if(m.attachEvent){m.attachEvent("on"+k,l)}else{m.addEventListener(k,l,false)}}function i(l){var m=document.createElement("script");m.src=l;m.async=true;var k=document.getElementsByTagName("script")[0];k.parentNode.insertBefore(m,k);e(m,"error",function(){b++})}function h(m,k,l){return l.replace(new RegExp(m,"g"),k)}f.forEach(function(k){k.url=h("__PROTOCOL__",encodeURIComponent(j),k.url);i(k.url)})};
